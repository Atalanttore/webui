<div class="widget stats-widget" ngClass.xs="double-height xs">
  <div class="card-container front">
    <mat-card
      class="front"
      fxLayout="row"
      fxLayoutWrap
      fxLayoutAlign="space-between stretch"
    >
      <mat-card-content class="card">
        <ix-drag-handle [showReorderHandle]="showReorderHandle">
          <ng-content [select]="[cdkDragHandle]"></ng-content>

          <mat-toolbar-row>
            <!-- Mobile Only: Exit widget -->
            <button
              *ngIf="screenType === ScreenType.Mobile"
              class="mat-card-title-text"
              mat-icon-button
              color="default"
              ixTest="help-back"
              (click)="goBack()"
            >
              <ix-icon name="chevron_left" class="back-arrow"></ix-icon>
            </button>

            <h3 class="mat-card-title-text">
              <ix-drag-handle [showReorderHandle]="showReorderHandle">
                <div class="card-title-text">
                  <span *ngIf="showReorderHandle" class="grip"></span>
                  <span>{{ 'Backup Tasks' | translate }}</span>
                </div>
              </ix-drag-handle>
            </h3>

            <div *ngIf="!!allCount" class="status-container">
              <ix-icon
                *ngIf="!failedCount"
                name="mdi-check-circle"
                class="icon healthy"
              ></ix-icon>
              <ix-icon
                *ngIf="!!failedCount"
                name="mdi-alert"
                class="icon warning"
              ></ix-icon>
              <span *ngIf="!!failedCount">
                {{ '{failed} of {all} tasks failed' | translate : { failed: failedCount, all: allCount } }}
              </span>
            </div>

            <div class="controls">
              <button mat-icon-button ixTest="go-to-backups">
                <ix-icon name="open_in_new"></ix-icon>
              </button>
            </div>
          </mat-toolbar-row>
        </ix-drag-handle>

        <div>
          <mat-grid-list gutterSize="5px" [cols]="1" [rowHeight]="105">
            <mat-grid-tile *ngFor="let tile of backupsTiles; trackBy: trackByTile">
              <div
                class="tile"
                fxFlexFill
                fxLayout="column"
                fxLayoutAlign="start stretch"
              >
                <div
                  class="tile-header"
                  fxLayout="row"
                  fxLayoutAlign="start center"
                >
                  <h4 class="tile-header-title">{{ tile.title }}</h4>
                  <div class="tile-header-button">
                    <a mat-icon-button ixTest="manage-tasks">
                      <ix-icon
                        matTooltipPosition="above"
                        [matTooltip]="'Manage Tasks' | translate"
                      >settings</ix-icon>
                    </a>
                  </div>
                </div>
                <div
                  class="tile-content"
                  fxFlex
                  fxLayout="row"
                  fxLayoutAlign="space-between center"
                >
                  <ul fxLayout="column" [fxFlex]="40">
                    <li fxLayout="row">
                      <span [class]="['icon', tile.failedSend ? 'warn' : 'safe']">
                        <ix-icon [name]="tile.failedSend ? 'mdi-alert' : 'mdi-check-circle'"></ix-icon>
                      </span>
                      <span class="label">
                        {{ '{tasks} send tasks' | translate : { tasks: tile.totalSend } }}
                      </span>
                    </li>
                    <li fxLayout="row">
                      <span [class]="['icon', tile.failedReceive ? 'warn' : 'safe']">
                        <ix-icon [name]="tile.failedReceive ? 'mdi-alert' : 'mdi-check-circle'"></ix-icon>
                      </span>
                      <span class="label">
                        {{ '{tasks} receive tasks' | translate : { tasks: tile.totalReceive } }}
                      </span>
                    </li>
                    <li fxLayout="row">
                      <span [class]="['icon', tile.failedSend + tile.failedReceive ? 'warn' : 'safe']">
                        <ix-icon [name]="tile.failedSend + tile.failedReceive ? 'mdi-alert' : 'mdi-check-circle'"></ix-icon>
                      </span>
                      <span class="label">
                        {{ 'Total failed' | translate }}: {{ tile.failedSend + tile.failedReceive }}
                      </span>
                    </li>
                  </ul>
                  <div class="divider"></div>
                  <ul fxLayout="column" [fxFlex]="60">
                    <li fxLayout="row">
                      <span class="label">
                        {{ '{tasks} successful send tasks this week' | translate : { tasks: tile.lastWeekSend } }}
                      </span>
                    </li>
                    <li fxLayout="row">
                      <span class="label">
                        {{ '{tasks} successful receive tasks this week' | translate : { tasks: tile.lastWeekReceive } }}
                      </span>
                    </li>
                    <li fxLayout="row">
                      <span class="label">
                        {{ 'Last successful task' }}:
                        {{ tile.lastSuccessfulTask ? (tile.lastSuccessfulTask | formatDateTime) : ('Never' | translate) }}
                      </span>
                    </li>
                  </ul>
                </div>
              </div>
            </mat-grid-tile>
            <mat-grid-tile *ngIf="!backupsTiles.length">
              <div class="empty-container">
                {{ 'No backup tasks configured' | translate }}
              </div>
            </mat-grid-tile>
            <mat-grid-tile *ngIf="backupsTiles.length < 3">
              <div class="footer-container">
                <div class="details-item">
                  <div class="label">{{ 'Actions' | translate }}</div>
                  <div class="label">{{ 'Documentation' | translate }}</div>
                </div>
                <div class="details-item">
                  <a class="action" ixTest="new-replication" [routerLink]="['/data-protection']">
                    {{ 'New Replication Wizard' | translate }}
                  </a>
                  <a class="action" ixTest="risks-no-backup">
                    {{ 'Risks of having no backup' | translate }}
                  </a>
                </div>
                <div class="details-item">
                  <a class="action" ixTest="new-cloudsync" [routerLink]="['/data-protection']">
                    {{ 'New Cloudsync Wizard' | translate }}
                  </a>
                  <a class="action" ixTest="backup-best-practices">
                    {{ 'Backup best practices' | translate }}
                  </a>
                </div>
              </div>
            </mat-grid-tile>
          </mat-grid-list>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
